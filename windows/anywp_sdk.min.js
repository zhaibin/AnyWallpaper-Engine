var AnyWPBundle=function(e){"use strict";const t={version:"4.2.0",dpiScale:window.devicePixelRatio||1,screenWidth:screen.width*(window.devicePixelRatio||1),screenHeight:screen.height*(window.devicePixelRatio||1),interactionEnabled:!0,_debugMode:!1,_clickHandlers:[],_mouseCallbacks:[],_keyboardCallbacks:[],_visibilityCallback:null,_mutationObserver:null,_resizeObserver:null,_spaMode:!1,_autoRefreshEnabled:!0,_draggableElements:[],_dragState:null,_persistedState:{},_init(){throw new Error("_init must be implemented")}},o={enabled:!1,enable(){this.enabled=!0,console.log("[AnyWP] Debug mode ENABLED")},log(e,t=!1){(this.enabled||t)&&console.log("[AnyWP] "+e)},showBorder(e,t,o){const n=t._anywpDebugBorder;n&&n.parentNode&&n.parentNode.removeChild(n);const i=document.createElement("div");i.className="AnyWP-debug-border",i.style.cssText="position: fixed;left: "+e.left/o+"px;top: "+e.top/o+"px;width: "+e.width/o+"px;height: "+e.height/o+"px;border: 2px solid red;box-shadow: 0 0 10px red;pointer-events: none;z-index: 999999;",document.body.appendChild(i),t._anywpDebugBorder=i},detectFromURL(){new URLSearchParams(window.location.search).has("debug")&&this.enable()}},n={setup(e,t,n){window.addEventListener("AnyWP:mouse",function(t){e._mouseCallbacks.forEach(function(e){e(t.detail)})}),window.addEventListener("AnyWP:keyboard",function(t){e._keyboardCallbacks.forEach(function(e){e(t.detail)})}),window.addEventListener("AnyWP:click",function(e){t.handleClick(e.detail.x,e.detail.y)}),window.addEventListener("AnyWP:interactionMode",function(t){e.interactionEnabled=t.detail.enabled,o.log("Interaction mode: "+(e.interactionEnabled?"ON":"OFF"),!0)}),window.addEventListener("AnyWP:visibility",function(t){const i=t.detail.visible;o.log("Visibility changed: "+(i?"visible":"hidden"),!0),e._visibilityCallback&&e._visibilityCallback(i),i?n.resume():n.pause()}),window.addEventListener("resize",function(){o.log("Window resized, refreshing..."),setTimeout(function(){t.refreshBounds()},200)})},onMouse(e,t){e._mouseCallbacks.push(t),o.log("Mouse callback registered")},onKeyboard(e,t){e._keyboardCallbacks.push(t),o.log("Keyboard callback registered")},onVisibilityChange(e,t){e._visibilityCallback=t,o.log("Visibility callback registered")},notifyVisibilityChange(e,t){if(console.log("[AnyWP] _notifyVisibilityChange called:",t),e._visibilityCallback&&"function"==typeof e._visibilityCallback)try{e._visibilityCallback(t),console.log("[AnyWP] Visibility callback executed successfully")}catch(e){console.error("[AnyWP] Error in visibility callback:",e)}else console.log("[AnyWP] No visibility callback registered");try{var o=new CustomEvent("AnyWP:visibility",{detail:{visible:t}});window.dispatchEvent(o),console.log("[AnyWP] AnyWP:visibility event dispatched")}catch(e){console.error("[AnyWP] Error dispatching visibility event:",e)}}},i={calculate(e,t){const o=e.getBoundingClientRect();return{left:Math.round(o.left*t),top:Math.round(o.top*t),right:Math.round(o.right*t),bottom:Math.round(o.bottom*t),width:Math.round(o.width*t),height:Math.round(o.height*t)}},isInBounds:(e,t,o)=>e>=o.left&&e<=o.right&&t>=o.top&&t<=o.bottom,isMouseOverElement(e,t,o,n){const i=o.getBoundingClientRect(),a=Math.round(i.left*n),l=Math.round(i.top*n),s=Math.round(i.right*n),r=Math.round(i.bottom*n);return e>=a&&e<=s&&t>=l&&t<=r}},a={detect(e,t){const o=this,n=!(!window.React&&!window.ReactDOM),i=!!window.Vue,a=!!window.angular;if(n||i||a){e._spaMode=!0;const a=n?"React":i?"Vue":"Angular";console.log("[AnyWP] SPA Framework detected: "+a),o.setupMonitoring(e,t)}else setTimeout(function(){const n=!!document.querySelector("[data-reactroot], [data-reactid], #root"),i=!!document.querySelector("[data-v-]"),a=!!document.querySelector("[ng-version]");if(n||i||a){e._spaMode=!0;const a=n?"React":i?"Vue":"Angular";console.log("[AnyWP] SPA Framework detected: "+a),o.setupMonitoring(e,t)}},500)},setSPAMode(e,t,o){e._spaMode=o,console.log("[AnyWP] SPA mode: "+(o?"ENABLED":"DISABLED")),o?this.setupMonitoring(e,t):this.teardownMonitoring(e)},setupMonitoring(e,t){const o=this,n=history.pushState,i=history.replaceState;history.pushState=function(){n.apply(history,arguments),o.onRouteChange(e,t)},history.replaceState=function(){i.apply(history,arguments),o.onRouteChange(e,t)},window.addEventListener("popstate",function(){o.onRouteChange(e,t)}),window.MutationObserver&&(e._mutationObserver=new MutationObserver(function(o){let n=!1;o.forEach(function(t){"childList"!==t.type&&"attributes"!==t.type||e._clickHandlers.forEach(function(e){(t.target===e.element||t.target.contains(e.element))&&(n=!0)})}),n&&t.refreshBounds(e)}),e._mutationObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}))},teardownMonitoring(e){e._mutationObserver&&(e._mutationObserver.disconnect(),e._mutationObserver=null)},onRouteChange(e,t){o.log("Route changed, refreshing..."),setTimeout(function(){e._clickHandlers.forEach(function(o){if(o.selector&&o.autoRefresh){const n=document.querySelector(o.selector);if(n&&n!==o.element&&(o.element=n,t.refreshElementBounds(e,o),o.resizeObserver&&o.resizeObserver.disconnect(),window.ResizeObserver)){const i=new ResizeObserver(function(){t.refreshElementBounds(e,o)});i.observe(n),o.resizeObserver=i}}}),t.refreshBounds(e)},500)}},l={handleClick(e,t,n){o.log("Click at: ("+t+","+n+")");for(let a=0;a<e._clickHandlers.length;a++){const l=e._clickHandlers[a];if(i.isInBounds(t,n,l.bounds)){o.log("HIT: "+(l.element.id||l.element.className)),l.callback(t,n);break}}},waitForElement(e,t,o=1e4){const n=Date.now();!function check(){const i=document.querySelector(e);i?t(i):Date.now()-n<o?setTimeout(check,100):console.error("[AnyWP] Element not found: "+e)}()},onClick(e,t,n,a={}){const l=this,s=a.immediate||!1,r=void 0!==a.waitFor?a.waitFor:!s,d=a.maxWait||1e4,c=void 0!==a.autoRefresh?a.autoRefresh:e._autoRefreshEnabled,u=a.delay||(s?0:100);function registerElement(s){if(!s)return void console.error("[AnyWP] Element not found:",t);const r=e._clickHandlers.findIndex(function(e){return e.element===s});-1!==r&&(o.log("Element already registered, updating bounds..."),e._clickHandlers.splice(r,1));const d=i.calculate(s,e.dpiScale),u={element:s,callback:n,bounds:d,selector:"string"==typeof t?t:null,autoRefresh:c,options:a};if(e._clickHandlers.push(u),c&&window.ResizeObserver){const t=new ResizeObserver(function(){l.refreshElementBounds(e,u)});t.observe(s),u.resizeObserver=t}(void 0!==a.debug?a.debug:e._debugMode)&&(console.log("[AnyWP] Click Handler Registered:",s.id||s.className),console.log("  Physical: ["+d.left+","+d.top+"] ~ ["+d.right+","+d.bottom+"]"),console.log("  Size: "+d.width+"x"+d.height),o.showBorder(d,s,e.dpiScale))}if(s){let e=t;"string"==typeof t&&(e=document.querySelector(t)),registerElement(e)}else r&&"string"==typeof t?this.waitForElement(t,registerElement,d):setTimeout(function(){let e=t;"string"==typeof t&&(e=document.querySelector(t)),registerElement(e)},u)},refreshElementBounds(e,t){if(!t.element||!t.element.isConnected)return;const n=i.calculate(t.element,e.dpiScale);(n.left!==t.bounds.left||n.top!==t.bounds.top||n.width!==t.bounds.width||n.height!==t.bounds.height)&&(t.bounds=n,t.element._anywpDebugBorder&&o.showBorder(n,t.element,e.dpiScale))},refreshBounds(e){const t=this;let n=0;return e._clickHandlers.forEach(function(o){o.element&&o.element.isConnected&&(t.refreshElementBounds(e,o),n++)}),o.log("Refreshed "+n+" elements",!0),n},clearHandlers(e){e._clickHandlers.forEach(function(e){if(e.resizeObserver&&e.resizeObserver.disconnect(),e.element&&e.element._anywpDebugBorder){const t=e.element._anywpDebugBorder;t.parentNode&&t.parentNode.removeChild(t)}}),e._clickHandlers=[],o.log("All handlers cleared",!0)}},s={pause(){if(!window.__anyWP_animationsPaused){console.log("[AnyWP] Auto-pausing all animations for power saving..."),window.__anyWP_animationsPaused=!0;try{var e=document.querySelectorAll("video");console.log("[AnyWP] Found "+e.length+" video(s)"),e.forEach(function(e){try{e.paused||(e.__anyWP_wasPlaying=!0,e.pause())}catch(e){console.warn("[AnyWP] Failed to pause video:",e)}});var t=document.querySelectorAll("audio");console.log("[AnyWP] Found "+t.length+" audio(s)"),t.forEach(function(e){try{e.paused||(e.__anyWP_wasPlaying=!0,e.pause())}catch(e){console.warn("[AnyWP] Failed to pause audio:",e)}});var o=document.getElementById("__anywp_pause_style");o||((o=document.createElement("style")).id="__anywp_pause_style",o.textContent="* { animation-play-state: paused !important; } *::before, *::after { animation-play-state: paused !important; }",document.head&&(document.head.appendChild(o),console.log("[AnyWP] CSS animations paused"))),window.__anyWP_originalRAF||(window.__anyWP_originalRAF=window.requestAnimationFrame,window.__anyWP_originalCancelRAF=window.cancelAnimationFrame,window.requestAnimationFrame=function(e){return 0},window.cancelAnimationFrame=function(e){},console.log("[AnyWP] requestAnimationFrame disabled")),console.log("[AnyWP] Auto-pause complete")}catch(e){console.error("[AnyWP] Error during auto-pause:",e)}}},resume(){if(window.__anyWP_animationsPaused){console.log("[AnyWP] Auto-resuming all animations..."),window.__anyWP_animationsPaused=!1;try{var e=document.getElementById("__anywp_pause_style");e&&(e.remove(),console.log("[AnyWP] CSS animations resumed")),window.__anyWP_originalRAF&&(window.requestAnimationFrame=window.__anyWP_originalRAF,window.cancelAnimationFrame=window.__anyWP_originalCancelRAF,delete window.__anyWP_originalRAF,delete window.__anyWP_originalCancelRAF,console.log("[AnyWP] requestAnimationFrame restored")),document.querySelectorAll("video").forEach(function(e){try{e.__anyWP_wasPlaying&&(e.play().catch(function(e){console.warn("[AnyWP] Failed to resume video:",e)}),delete e.__anyWP_wasPlaying)}catch(e){console.warn("[AnyWP] Error resuming video:",e)}}),document.querySelectorAll("audio").forEach(function(e){try{e.__anyWP_wasPlaying&&(e.play().catch(function(e){console.warn("[AnyWP] Failed to resume audio:",e)}),delete e.__anyWP_wasPlaying)}catch(e){console.warn("[AnyWP] Error resuming audio:",e)}}),console.log("[AnyWP] Auto-resume complete")}catch(e){console.error("[AnyWP] Error during auto-resume:",e)}}}};const r={load(e,t,o){if(console.log("[AnyWP] Loading state for key:",t),e._persistedState[t])return console.log("[AnyWP] Found in cache:",e._persistedState[t]),void o(e._persistedState[t]);if(window.chrome&&window.chrome.webview){console.log("[AnyWP] Requesting state from native layer...");const handler=function(n){if(n.detail&&"stateLoaded"===n.detail.type&&n.detail.key===t){console.log("[AnyWP] Received stateLoaded event:",n.detail),window.removeEventListener("AnyWP:stateLoaded",handler);const i=n.detail.value?JSON.parse(n.detail.value):null;e._persistedState[t]=i,console.log("[AnyWP] State loaded successfully:",i),o(i)}};window.addEventListener("AnyWP:stateLoaded",handler),window.chrome.webview.postMessage({type:"loadState",key:t}),setTimeout(function(){window.removeEventListener("AnyWP:stateLoaded",handler),console.log("[AnyWP] loadState timeout for key:",t),o(null)},1e3)}else{console.warn("[AnyWP] chrome.webview not available, using localStorage");try{const n=localStorage.getItem("AnyWP_"+t),i=n?JSON.parse(n):null;e._persistedState[t]=i,console.log("[AnyWP] Loaded from localStorage:",i),o(i)}catch(e){console.error("[AnyWP] Failed to load state:",e),o(null)}}},save(e,t,n){if(e._persistedState[t]=n,window.chrome&&window.chrome.webview)window.chrome.webview.postMessage({type:"saveState",key:t,value:JSON.stringify(n)}),o.log("Saved state for "+t);else try{localStorage.setItem("AnyWP_"+t,JSON.stringify(n)),o.log("Saved state to localStorage for "+t)}catch(e){console.warn("[AnyWP] Failed to save state:",e)}},clear(e){if(e._persistedState={},window.chrome&&window.chrome.webview)window.chrome.webview.postMessage({type:"clearState"}),o.log("Cleared all saved state");else try{Object.keys(localStorage).forEach(function(e){e.startsWith("AnyWP_")&&localStorage.removeItem(e)}),o.log("Cleared localStorage state")}catch(e){console.warn("[AnyWP] Failed to clear state:",e)}},saveElementPosition(e,t,o,n){const i={left:o,top:n};if(console.log("[AnyWP] Saving position for "+t+": ",i),e._persistedState[t]=i,window.chrome&&window.chrome.webview){const e={type:"saveState",key:t,value:JSON.stringify(i)};console.log("[AnyWP] Sending saveState message:",e),window.chrome.webview.postMessage(e),console.log("[AnyWP] Message sent successfully")}else{console.warn("[AnyWP] chrome.webview not available, using localStorage");try{localStorage.setItem("AnyWP_"+t,JSON.stringify(i)),console.log("[AnyWP] Saved to localStorage for "+t)}catch(e){console.error("[AnyWP] Failed to save state:",e)}}}},d={makeDraggable(e,t,n={}){const i=n.persistKey||null,a=n.onDragStart||null,l=n.onDrag||null,s=n.onDragEnd||null,d=n.bounds||null;let c=t;if("string"==typeof t&&(c=document.querySelector(t)),!c)return void console.error("[AnyWP] Element not found:",t);i&&r.load(e,i,function(e){e&&(c.style.position="absolute",c.style.left=e.left+"px",c.style.top=e.top+"px",console.log("[AnyWP] Restored position for "+i+": "+e.left+","+e.top))});const u={element:c,persistKey:i,onDragStart:a,onDrag:l,onDragEnd:s,bounds:d};function handleGlobalMouse(t){if(!e.interactionEnabled)return void o.log("[makeDraggable] Interaction disabled, ignoring event");const n=t.detail,g=n.x,y=n.y,m=n.type,w=c.getBoundingClientRect(),f=e.dpiScale,h=void 0!==window.screenX?window.screenX:0,p=void 0!==window.screenY?window.screenY:0,b=document.documentElement.getBoundingClientRect(),_=g/f-h-b.left,v=y/f-p-b.top,P=w.left,S=w.top,A=w.right,W=w.bottom,E=_>=P&&_<=A&&v>=S&&v<=W;if("mousedown"===m){const t=c.id||c.className||"unknown";console.log("[AnyWP] [makeDraggable] mousedown on "+t+" - Mouse (screen):",g,y,"Mouse (viewport CSS):",_.toFixed(1),v.toFixed(1),"Element (viewport CSS):",P.toFixed(1),S.toFixed(1),A.toFixed(1),W.toFixed(1),"isOver:",E,"dragState:",e._dragState?"EXISTS":"NULL","Window offset:",h,p,"Doc offset:",b.left.toFixed(1),b.top.toFixed(1),"DPI:",f);const o=document.getElementById("drag-status");o&&(E?(o.innerHTML="ðŸ“ æ£€æµ‹åˆ°ç‚¹å‡»åœ¨ "+t+" ä¸Š - å‡†å¤‡æ‹–æ‹½",o.style.color="#4CAF50"):(o.innerHTML="ðŸ“ ç‚¹å‡»ä¸åœ¨ "+t+" ä¸Š (é¼ æ ‡: "+_.toFixed(0)+","+v.toFixed(0)+" | å…ƒç´ : "+P.toFixed(0)+","+S.toFixed(0)+"-"+A.toFixed(0)+","+W.toFixed(0)+")",o.style.color="#ff9800"))}if("mousemove"!==m&&o.log("[makeDraggable] Mouse event: "+m+" at screen ("+g+","+y+") -> viewport CSS ("+_.toFixed(1)+","+v.toFixed(1)+")"),"mousedown"===m&&E&&!e._dragState)console.log("[AnyWP] [Drag] START - Mouse at viewport CSS ("+_.toFixed(1)+","+v.toFixed(1)+")"),e._dragState={element:c,data:u,startX:_,startY:v,offsetX:_-P,offsetY:v-S,initialLeft:P,initialTop:S,windowLeft:h,windowTop:p,docLeft:b.left,docTop:b.top,dpi:f},a&&a({x:P,y:S}),o.log("Drag start at: "+_.toFixed(1)+","+v.toFixed(1)+" (element at "+P.toFixed(1)+","+S.toFixed(1)+")",!0);else if("mousemove"===m&&e._dragState&&e._dragState.element===c){const t=g/e._dragState.dpi-e._dragState.windowLeft-e._dragState.docLeft,o=y/e._dragState.dpi-e._dragState.windowTop-e._dragState.docTop;let n=t-e._dragState.offsetX,i=o-e._dragState.offsetY;d&&(void 0!==d.left&&(n=Math.max(d.left,n)),void 0!==d.top&&(i=Math.max(d.top,i)),void 0!==d.right&&(n=Math.min(d.right-c.offsetWidth,n)),void 0!==d.bottom&&(i=Math.min(d.bottom-c.offsetHeight,i))),c.style.left=n+"px",c.style.top=i+"px",l&&l({x:n,y:i,deltaX:t-e._dragState.startX,deltaY:o-e._dragState.startY})}else if("mouseup"===m&&e._dragState&&e._dragState.element===c){console.log("[AnyWP] [Drag] END");const t=c.getBoundingClientRect(),n={x:t.left,y:t.top};i&&r.saveElementPosition(e,i,n.x,n.y),s&&s(n),o.log("Drag end at: "+n.x+","+n.y,!0),e._dragState=null}else("mousedown"!==m||E)&&"mousemove"===m&&e._dragState&&e._dragState.element!==c&&console.log("[AnyWP] [makeDraggable] mousemove but wrong element")}e._draggableElements.push(u),"static"===window.getComputedStyle(c).position&&(c.style.position="absolute"),c.style.cursor="move",c.style.userSelect="none",c.style.webkitUserSelect="none",c.style.mozUserSelect="none",c.style.msUserSelect="none",c.draggable=!1,c.ondragstart=function(e){return e.preventDefault(),!1},c.onselectstart=function(e){return e.preventDefault(),!1},window.addEventListener("AnyWP:mouse",handleGlobalMouse),c.__anyWP_dragHandler={handleGlobalMouse:handleGlobalMouse},o.log("Element made draggable (via mouse hook): "+(c.id||c.className))},removeDraggable(e,t){let n=t;"string"==typeof t&&(n=document.querySelector(t)),n?(n.__anyWP_dragHandler&&(window.removeEventListener("AnyWP:mouse",n.__anyWP_dragHandler.handleGlobalMouse),delete n.__anyWP_dragHandler),e._draggableElements=e._draggableElements.filter(function(e){return e.element!==n}),n.style.cursor="",n.style.userSelect="",o.log("Removed draggable from element: "+(n.id||n.className))):console.error("[AnyWP] Element not found:",t)},resetPosition(e,t,o){let n=t;if("string"==typeof t&&(n=document.querySelector(t)),!n)return console.error("[AnyWP] Element not found:",t),!1;const i=e._draggableElements.find(function(e){return e.element===n});if(o?(n.style.left=o.left+"px",n.style.top=o.top+"px"):(n.style.left="",n.style.top=""),i&&i.persistKey){const t=i.persistKey;if(delete e._persistedState[t],window.chrome&&window.chrome.webview)window.chrome.webview.postMessage({type:"saveState",key:t,value:o?JSON.stringify(o):""});else try{o?localStorage.setItem("AnyWP_"+t,JSON.stringify(o)):localStorage.removeItem("AnyWP_"+t)}catch(e){console.warn("[AnyWP] Failed to reset position:",e)}console.log("[AnyWP] Reset position for "+t)}return!0}};return t._init=function(){var e;e=this,console.log("========================================"),console.log("AnyWP Engine v"+e.version+" (SPA Compatible)"),console.log("========================================"),console.log("Screen: "+e.screenWidth+"x"+e.screenHeight),console.log("DPI Scale: "+e.dpiScale+"x"),console.log("Interaction Enabled: "+e.interactionEnabled),console.log("========================================"),o.detectFromURL(),a.detect(e,l),n.setup(e,l,s),e._debugMode=!0,console.log("[AnyWP] Debug mode ENABLED automatically")},t.enableDebug=function(){o.enable()},t.onClick=function(e,t,o){l.onClick(this,e,t,o)},t.refreshBounds=function(){return l.refreshBounds(this)},t.clearHandlers=function(){l.clearHandlers(this)},t.makeDraggable=function(e,t){d.makeDraggable(this,e,t)},t.removeDraggable=function(e){d.removeDraggable(this,e)},t.resetPosition=function(e,t){return d.resetPosition(this,e,t)},t.saveState=function(e,t){r.save(this,e,t)},t.loadState=function(e,t){r.load(this,e,t)},t.clearState=function(){r.clear(this)},t.onMouse=function(e){n.onMouse(this,e)},t.onKeyboard=function(e){n.onKeyboard(this,e)},t.onVisibilityChange=function(e){n.onVisibilityChange(this,e)},t._notifyVisibilityChange=function(e){n.notifyVisibilityChange(this,e)},t.setSPAMode=function(e){a.setSPAMode(this,l,e)},t.openURL=function(e){o.log("Opening URL: "+e),window.chrome&&window.chrome.webview?window.chrome.webview.postMessage({type:"openURL",url:e}):(console.warn("[AnyWP] Native bridge not available"),window.open(e,"_blank"))},t.ready=function(e){o.log("Wallpaper ready: "+e,!0),window.chrome&&window.chrome.webview&&window.chrome.webview.postMessage({type:"ready",name:e})},"undefined"!=typeof window&&(window.AnyWP=t,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t._init()}):t._init(),console.log("[AnyWP] SDK loaded successfully")),e.AnyWP=t,e}({});
//# sourceMappingURL=anywp_sdk.min.js.map
