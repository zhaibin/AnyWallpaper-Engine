var AnyWPBundle=function(e){"use strict";const t={version:"2.1.1",dpiScale:window.devicePixelRatio||1,screenWidth:screen.width*(window.devicePixelRatio||1),screenHeight:screen.height*(window.devicePixelRatio||1),_debugMode:!1,_clickHandlers:[],_mouseCallbacks:[],_keyboardCallbacks:[],_visibilityCallback:null,_mutationObserver:null,_resizeObserver:null,_spaMode:!1,_autoRefreshEnabled:!0,_persistedState:{},_onFlutterMessage:null,_init(){throw new Error("_init must be implemented")},_log(e,t){throw new Error("Not implemented")},log(e){throw new Error("Not implemented")},enableDebug(){throw new Error("Not implemented")},onClick(){throw new Error("Not implemented")},refreshBounds(){throw new Error("Not implemented")},clearHandlers(){throw new Error("Not implemented")},saveState(){throw new Error("Not implemented")},loadState(){throw new Error("Not implemented")},clearState(){throw new Error("Not implemented")},onMouse(){throw new Error("Not implemented")},onKeyboard(){throw new Error("Not implemented")},onVisibilityChange(){throw new Error("Not implemented")},_notifyVisibilityChange(){throw new Error("Not implemented")},setSPAMode(){throw new Error("Not implemented")},openURL(e){console.log("[AnyWP] Opening URL: "+e),window.chrome?.webview?window.chrome.webview.postMessage({type:"openURL",url:e}):(console.warn("[AnyWP] Native bridge not available"),window.open(e,"_blank"))},ready(e){console.log("[AnyWP] Wallpaper ready: "+e),window.chrome?.webview&&window.chrome.webview.postMessage({type:"ready",name:e})},sendToFlutter(e,t){throw new Error("Not implemented - will be injected by webmessage module")},onMessage(e){console.log("[AnyWP] Registering Flutter message handler"),this._onFlutterMessage=e}},n={enabled:!1,enable(){this.enabled=!0,console.log("[AnyWP] Debug mode ENABLED")},log(e,t=!1){(this.enabled||t)&&console.log("[AnyWP] "+e)},showBorder(e,t,n){const o=t._anywpDebugBorder;o&&o.parentNode&&o.parentNode.removeChild(o);const i=document.createElement("div");i.className="AnyWP-debug-border",i.style.cssText="position: fixed;left: "+e.left/n+"px;top: "+e.top/n+"px;width: "+e.width/n+"px;height: "+e.height/n+"px;border: 2px solid red;box-shadow: 0 0 10px red;pointer-events: none;z-index: 999999;",document.body.appendChild(i),t._anywpDebugBorder=i},detectFromURL(){new URLSearchParams(window.location.search).has("debug")&&this.enable()}},o={_setupCompleted:!1,_eventHandlers:{},setup(e,t,o){this._setupCompleted?console.log("[AnyWP] Events already setup, skipping duplicate initialization"):(this._eventHandlers.mouse=function(t){const n=t;e._mouseCallbacks.forEach(function(e){e(n.detail)})},this._eventHandlers.keyboard=function(t){const n=t;e._keyboardCallbacks.forEach(function(e){e(n.detail)})},this._eventHandlers.click=function(e){const n=e;t.handleClick(n.detail.x,n.detail.y)},this._eventHandlers.visibility=function(t){const i=t.detail.visible;n.log("Visibility changed: "+(i?"visible":"hidden"),!0),e._visibilityCallback&&e._visibilityCallback(i),i?o.resume(e):o.pause(e)},this._eventHandlers.resize=function(){n.log("Window resized, refreshing..."),setTimeout(function(){t.refreshBounds(e)},200)},window.addEventListener("AnyWP:mouse",this._eventHandlers.mouse),window.addEventListener("AnyWP:keyboard",this._eventHandlers.keyboard),window.addEventListener("AnyWP:click",this._eventHandlers.click),window.addEventListener("AnyWP:visibility",this._eventHandlers.visibility),window.addEventListener("resize",this._eventHandlers.resize),this._setupCompleted=!0,console.log("[AnyWP] Events setup completed"))},onMouse(e,t){e._mouseCallbacks.push(t),n.log("Mouse callback registered")},onKeyboard(e,t){e._keyboardCallbacks.push(t),n.log("Keyboard callback registered")},onVisibilityChange(e,t){e._visibilityCallback=t,n.log("Visibility callback registered")},notifyVisibilityChange(e,t){if(console.log("[AnyWP] _notifyVisibilityChange called:",t),e._visibilityCallback&&"function"==typeof e._visibilityCallback)try{e._visibilityCallback(t),console.log("[AnyWP] Visibility callback executed successfully")}catch(e){console.error("[AnyWP] Error in visibility callback:",e)}else console.log("[AnyWP] No visibility callback registered");try{const e=new CustomEvent("AnyWP:visibility",{detail:{visible:t}});window.dispatchEvent(e),console.log("[AnyWP] AnyWP:visibility event dispatched")}catch(e){console.error("[AnyWP] Error dispatching visibility event:",e)}}},i={detect(e,t){const n=this,o=!(!window.React&&!window.ReactDOM),i=!!window.Vue,s=!!window.angular;if(o||i||s){e._spaMode=!0;const s=o?"React":i?"Vue":"Angular";console.log("[AnyWP] SPA Framework detected: "+s),n.setupMonitoring(e,t)}else setTimeout(function(){const o=!!document.querySelector("[data-reactroot], [data-reactid], #root"),i=!!document.querySelector("[data-v-]"),s=!!document.querySelector("[ng-version]");if(o||i||s){e._spaMode=!0;const s=o?"React":i?"Vue":"Angular";console.log("[AnyWP] SPA Framework detected: "+s),n.setupMonitoring(e,t)}},500)},setSPAMode(e,t,n){e._spaMode=n,console.log("[AnyWP] SPA mode: "+(n?"ENABLED":"DISABLED")),n?this.setupMonitoring(e,t):this.teardownMonitoring(e)},setupMonitoring(e,t){const n=this,o=history.pushState,i=history.replaceState;history.pushState=function(i,s,r){o.call(history,i,s,r),n.onRouteChange(e,t)},history.replaceState=function(o,s,r){i.call(history,o,s,r),n.onRouteChange(e,t)},window.addEventListener("popstate",function(){n.onRouteChange(e,t)}),window.MutationObserver&&(e._mutationObserver=new MutationObserver(function(n){let o=!1;n.forEach(function(t){"childList"!==t.type&&"attributes"!==t.type||e._clickHandlers.forEach(function(e){(t.target===e.element||t.target.contains(e.element))&&(o=!0)})}),o&&t.refreshBounds(e)}),e._mutationObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}))},teardownMonitoring(e){e._mutationObserver&&(e._mutationObserver.disconnect(),e._mutationObserver=null)},onRouteChange(e,t){n.log("Route changed, refreshing..."),setTimeout(function(){e._clickHandlers.forEach(function(n){if(n.selector&&n.autoRefresh){const o=document.querySelector(n.selector);if(o&&o!==n.element&&(n.element=o,t.refreshElementBounds(e,n),n.resizeObserver&&n.resizeObserver.disconnect(),window.ResizeObserver)){const i=new ResizeObserver(function(){t.refreshElementBounds(e,n)});i.observe(o),n.resizeObserver=i}}}),t.refreshBounds(e)},500)}},s={calculate(e,t){let n=e;if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error(`[AnyWP] Element not found: ${e}`);n=t}if(!n||"function"!=typeof n.getBoundingClientRect)throw console.error("[AnyWP] Invalid element passed to Bounds.calculate:",e),new TypeError("[AnyWP] Element must be a valid DOM element or selector");const o=n.getBoundingClientRect();return{left:Math.round(o.left*t),top:Math.round(o.top*t),right:Math.round(o.right*t),bottom:Math.round(o.bottom*t),width:Math.round(o.width*t),height:Math.round(o.height*t)}},isInBounds:(e,t,n)=>e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom,isMouseOverElement(e,t,n,o){let i=n;if("string"==typeof n){const e=document.querySelector(n);if(!e)return!1;i=e}if(!i||"function"!=typeof i.getBoundingClientRect)return console.error("[AnyWP] Invalid element passed to isMouseOverElement:",n),!1;const s=i.getBoundingClientRect(),r=Math.round(s.left*o),a=Math.round(s.top*o),l=Math.round(s.right*o),c=Math.round(s.bottom*o);return e>=r&&e<=l&&t>=a&&t<=c}},r={handleClick(e,t){n.log("Click at: ("+e+","+t+")");const o=window.AnyWP;for(let i=0;i<o._clickHandlers.length;i++){const r=o._clickHandlers[i];if(r&&s.isInBounds(e,t,r.bounds)){n.log("HIT: "+(r.element.id||r.element.className)),r.callback(e,t);break}}},waitForElement(e,t,n=1e4){const o=Date.now();!function check(){const i=document.querySelector(e);i?t(i):Date.now()-o<n?setTimeout(check,100):console.error("[AnyWP] Element not found: "+e)}()},onClick(e,t,o,i={}){if("function"==typeof t)throw console.error("[AnyWP] onClick: First parameter should be element, not callback!"),console.error("[AnyWP] Correct usage: AnyWP.onClick(element, callback, options)"),console.error('[AnyWP] Example: AnyWP.onClick("#my-button", (x, y) => { ... })'),new TypeError("[AnyWP] onClick: Invalid parameters - element must be HTMLElement or selector string");if("function"!=typeof o)throw console.error("[AnyWP] onClick: Second parameter must be a callback function!"),console.error("[AnyWP] Correct usage: AnyWP.onClick(element, callback, options)"),new TypeError("[AnyWP] onClick: callback must be a function");const r=this,a=i.immediate||!1,l=void 0!==i.waitFor?i.waitFor:!a,c=i.maxWait||1e4,d=void 0!==i.autoRefresh?i.autoRefresh:e._autoRefreshEnabled,u=i.delay||(a?0:100);function registerElement(a){if(!a)return void console.error("[AnyWP] Element not found:",t);const l=e._clickHandlers.findIndex(function(e){return e.element===a});if(-1!==l){const t=e._clickHandlers[l];return void(t&&(console.warn("[AnyWP] Element already has click handler, skipping duplicate registration:",a.id||a.className),console.warn("[AnyWP] Existing handler callback:",t.callback.toString().substring(0,100)),console.warn("[AnyWP] New callback (ignored):",o.toString().substring(0,100))))}const c=s.calculate(a,e.dpiScale),u={element:a,callback:o,bounds:c,selector:"string"==typeof t?t:null,autoRefresh:d,options:i};if(e._clickHandlers.push(u),d){if(window.ResizeObserver){const t=new ResizeObserver(function(){r.refreshElementBounds(e,u)});t.observe(a),u.resizeObserver=t}if(window.IntersectionObserver){const t=new IntersectionObserver(function(t){t.forEach(function(t){(t.isIntersecting||t.intersectionRatio>0)&&r.refreshElementBounds(e,u)})},{threshold:[0,.1,.5,.9,1]});t.observe(a),u.intersectionObserver=t}u.positionCheckTimer||(u.lastBounds=c,u.positionCheckTimer=setInterval(function(){if(!a.isConnected)return void clearInterval(u.positionCheckTimer);const t=a.getBoundingClientRect(),o=Math.round(t.left*e.dpiScale),i=Math.round(t.top*e.dpiScale);!u.lastBounds||o===u.lastBounds.left&&i===u.lastBounds.top||(r.refreshElementBounds(e,u),n.log("Position changed for: "+(a.id||a.className),!1))},100))}(void 0!==i.debug?i.debug:e._debugMode)&&(console.log("[AnyWP] Click Handler Registered:",a.id||a.className),console.log("  Physical: ["+c.left+","+c.top+"] ~ ["+c.right+","+c.bottom+"]"),console.log("  Size: "+c.width+"x"+c.height),n.showBorder(c,a,e.dpiScale))}if(a){let e;e="string"==typeof t?document.querySelector(t):t,registerElement(e)}else l&&"string"==typeof t?this.waitForElement(t,registerElement,c):setTimeout(function(){let e;e="string"==typeof t?document.querySelector(t):t,registerElement(e)},u)},refreshElementBounds(e,t){if(!t.element||!t.element.isConnected)return;const o=s.calculate(t.element,e.dpiScale);(o.left!==t.bounds.left||o.top!==t.bounds.top||o.width!==t.bounds.width||o.height!==t.bounds.height)&&(t.bounds=o,t.lastBounds=o,t.element._anywpDebugBorder&&n.showBorder(o,t.element,e.dpiScale))},refreshBounds(e){const t=this;let o=0;return e._clickHandlers.forEach(function(n){n.element&&n.element.isConnected&&(t.refreshElementBounds(e,n),o++)}),n.log("Refreshed "+o+" elements",!0),o},clearHandlers(e){e._clickHandlers.forEach(function(e){if(e.resizeObserver&&e.resizeObserver.disconnect(),e.intersectionObserver&&e.intersectionObserver.disconnect(),e.positionCheckTimer&&clearInterval(e.positionCheckTimer),e.element&&e.element._anywpDebugBorder){const t=e.element._anywpDebugBorder;t.parentNode&&t.parentNode.removeChild(t)}}),e._clickHandlers=[],n.log("All handlers cleared",!0)}},a={pause(e){if(!window.__anyWP_animationsPaused){console.log("[AnyWP] Auto-pausing all animations for power saving..."),window.__anyWP_animationsPaused=!0;try{const e=document.querySelectorAll("video");console.log("[AnyWP] Found "+e.length+" video(s)"),e.forEach(e=>{try{e.paused||(e.__anyWP_wasPlaying=!0,e.pause())}catch(e){console.warn("[AnyWP] Failed to pause video:",e)}});const t=document.querySelectorAll("audio");console.log("[AnyWP] Found "+t.length+" audio(s)"),t.forEach(e=>{try{e.paused||(e.__anyWP_wasPlaying=!0,e.pause())}catch(e){console.warn("[AnyWP] Failed to pause audio:",e)}});let n=document.getElementById("__anywp_pause_style");n||(n=document.createElement("style"),n.id="__anywp_pause_style",n.textContent="* { animation-play-state: paused !important; } *::before, *::after { animation-play-state: paused !important; }",document.head&&(document.head.appendChild(n),console.log("[AnyWP] CSS animations paused"))),window.__anyWP_originalRAF||(window.__anyWP_originalRAF=window.requestAnimationFrame,window.__anyWP_originalCancelRAF=window.cancelAnimationFrame,window.requestAnimationFrame=e=>0,window.cancelAnimationFrame=e=>{},console.log("[AnyWP] requestAnimationFrame disabled")),console.log("[AnyWP] Auto-pause complete")}catch(e){console.error("[AnyWP] Error during auto-pause:",e)}}},resume(e){if(window.__anyWP_animationsPaused){console.log("[AnyWP] Auto-resuming all animations..."),window.__anyWP_animationsPaused=!1;try{const e=document.getElementById("__anywp_pause_style");e&&(e.remove(),console.log("[AnyWP] CSS animations resumed")),window.__anyWP_originalRAF&&(window.requestAnimationFrame=window.__anyWP_originalRAF,window.cancelAnimationFrame=window.__anyWP_originalCancelRAF,delete window.__anyWP_originalRAF,delete window.__anyWP_originalCancelRAF,console.log("[AnyWP] requestAnimationFrame restored"));document.querySelectorAll("video").forEach(e=>{try{e.__anyWP_wasPlaying&&(e.play().catch(e=>{console.warn("[AnyWP] Failed to resume video:",e)}),delete e.__anyWP_wasPlaying)}catch(e){console.warn("[AnyWP] Error resuming video:",e)}});document.querySelectorAll("audio").forEach(e=>{try{e.__anyWP_wasPlaying&&(e.play().catch(e=>{console.warn("[AnyWP] Failed to resume audio:",e)}),delete e.__anyWP_wasPlaying)}catch(e){console.warn("[AnyWP] Error resuming audio:",e)}}),console.log("[AnyWP] Auto-resume complete")}catch(e){console.error("[AnyWP] Error during auto-resume:",e)}}}};let l=0,c=0,d=!1;function forceMouseOverEvent(e,t){const n=window.AnyWP;try{n._log("[Wallpaper] forceMouseOverEvent("+e+", "+t+") called",!0);const o=document.elementFromPoint(e,t);if(!o)return void n._log("[Wallpaper] ERROR: No element at position ("+e+","+t+")",!0);const i=o.tagName+(o.className?"."+o.className:"")+(o.id?"#"+o.id:"");n._log("[Wallpaper] Target element: "+i,!0);const s=new MouseEvent("mouseover",{view:window,bubbles:!0,cancelable:!0,clientX:e,clientY:t,screenX:e,screenY:t,button:0,buttons:0,relatedTarget:null}),r=o.dispatchEvent(s);n._log("[Wallpaper] MouseEvent dispatched: "+r,!0);const a=new CustomEvent("wallpaper:forceMouseUpdate",{detail:{x:e,y:t,element:o,elementInfo:i},bubbles:!0});document.dispatchEvent(a),n._log("[Wallpaper] [OK] Mouseover events dispatched successfully",!0)}catch(e){n._log("[Wallpaper] EXCEPTION in forceMouseOverEvent: "+e,!0)}}function setInteractive(e){const t=window.AnyWP;try{t._log("[Wallpaper] setInteractive("+e+") called",!0),window.chrome?.webview?(t._log("[Wallpaper] Sending setInteractive message to C++...",!0),window.chrome.webview.postMessage({type:"setInteractive",interactive:e}),d=e,t._log("[Wallpaper] [OK] Interactive mode: "+(e?"ENABLED":"DISABLED"),!0)):(t._log("[Wallpaper] ERROR: chrome.webview not available!",!0),t._log("[Wallpaper] window.chrome = "+typeof window.chrome,!0),t._log("[Wallpaper] window.chrome.webview = "+typeof window.chrome?.webview,!0))}catch(e){t._log("[Wallpaper] EXCEPTION in setInteractive: "+e,!0)}}function nextFrame(){return new Promise(e=>{requestAnimationFrame(()=>{e()})})}function handleMouseDown(e){const t=e,n=window.AnyWP;l=t.clientX,c=t.clientY,n._log("[Wallpaper] mousedown at ("+l+","+c+")",!0)}function handleMouseUp(e){const t=e,n=window.AnyWP;l=t.clientX,c=t.clientY,n._log("[Wallpaper] mouseup at ("+l+","+c+")",!0),async function(){const e=window.AnyWP;try{e._log("[Wallpaper] === Restoring Transparency ===",!0),e._log("[Wallpaper] Last mouse position: ("+l+","+c+")",!0),e._log("[Wallpaper] Waiting 1 frame for event completion...",!0),await nextFrame(),e._log("[Wallpaper] Waiting 1 frame for style update...",!0),await nextFrame(),e._log("[Wallpaper] Forcing mouseover event...",!0),forceMouseOverEvent(l,c),e._log("[Wallpaper] [OK] Transparency restore sequence complete",!0)}catch(t){e._log("[Wallpaper] EXCEPTION in restoreTransparency: "+t,!0)}}().catch(e=>{n._log("[Wallpaper] Error in restoreTransparency: "+e,!0)})}function handleMouseMove$1(e){const t=e;l=t.clientX,c=t.clientY}var u;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(u||(u={}));class w{constructor(e,t){this.parent=e,this.scopeName=t}addScope(...e){return[`[${this.scopeName}]`,...e]}error(...e){this.parent.error(...this.addScope(...e))}warn(...e){this.parent.warn(...this.addScope(...e))}info(...e){this.parent.info(...this.addScope(...e))}debug(...e){this.parent.debug(...this.addScope(...e))}}const m=new class{constructor(){this.config={level:u.INFO,prefix:"[AnyWP]",timestamp:!1}}setLevel(e){this.config.level=e,this.info("Log level set to:",u[e])}getLevel(){return this.config.level}enableTimestamp(e=!0){this.config.timestamp=e}format(e,...t){const n=[];if(n.push(this.config.prefix),this.config.timestamp){const e=(new Date).toISOString().substring(11,23);n.push(`[${e}]`)}return n.push(`[${e}]`),n.push(...t),n}error(...e){this.config.level>=u.ERROR&&console.error(...this.format("ERROR",...e))}warn(...e){this.config.level>=u.WARN&&console.warn(...this.format("WARN",...e))}info(...e){this.config.level>=u.INFO&&console.log(...this.format("INFO",...e))}debug(...e){this.config.level>=u.DEBUG&&console.log(...this.format("DEBUG",...e))}scope(e){return new w(this,e)}};const p={screenToViewport(e,t,n){const o=void 0!==window.screenX?window.screenX:0,i=void 0!==window.screenY?window.screenY:0,s=document.documentElement.getBoundingClientRect();return{x:e/n-o-s.left,y:t/n-i-s.top}},getOffsets(e){const t=void 0!==window.screenX?window.screenX:0,n=void 0!==window.screenY?window.screenY:0,o=document.documentElement.getBoundingClientRect();return{windowLeft:t,windowTop:n,docLeft:o.left,docTop:o.top,dpi:e}}};const g=m.scope("WebMessage"),h=new WeakMap;let y=[],f=Date.now();function handleWebMessage(e){let t=e.data;if(t)try{if("string"==typeof t)try{t=JSON.parse(t),console.log("[WebMessage] Parsed string message:",t)}catch(e){return void g.warn("Failed to parse WebMessage string:",t)}!function(e){"mouseEvent"===e.type&&"mousemove"===e.eventType?(window._anywp_msg_count||(window._anywp_msg_count=0),window._anywp_msg_count++,window._anywp_msg_count%100==0&&g.debug("WebMessage received #"+window._anywp_msg_count+": "+e.eventType)):"mouseEvent"===e.type&&g.debug("WebMessage: "+e.eventType+" at ("+e.x+","+e.y+")")}(t),!function(e){return"mouseEvent"===e.type}(t)?"powerStateChange"===t.type&&function(e){console.log("[C++] [PowerStateChange] Received:",e);const t=window.AnyWP;if(!t||"function"!=typeof t._notifyVisibilityChange)return void console.warn("[C++] [PowerStateChange] AnyWP._notifyVisibilityChange not available");const n=!0===e.visible,o=e.reason||"unknown";console.log("[C++] [PowerStateChange] Notifying visibility change:",n,"reason:",o),t._notifyVisibilityChange(n)}(t):function(e){try{const t=window.AnyWP,n=p.screenToViewport(e.x,e.y,t.dpiScale);g.debug("[CoordinateConversion] Screen ("+e.x+","+e.y+") -> Viewport ("+Math.round(n.x)+","+Math.round(n.y)+") DPI:"+t.dpiScale);const o={view:window,bubbles:!0,cancelable:!0,clientX:n.x,clientY:n.y,screenX:e.x,screenY:e.y,button:e.button||0,buttons:0===e.button?1:0};if("mousemove"===e.eventType)return void v(o,e);!function(e,t,n){let o=null;o=((e,t)=>{g.debug("[ElementFinder] Searching at viewport coordinates:",e,t),g.debug("[ElementFinder] Window size:",window.innerWidth,"x",window.innerHeight);const n=function(){const e=Date.now();if(e-f>1e3||0===y.length){const t=["button","a","input","textarea","select","[onclick]",".clickable",'[role="button"]',".hover-box","[onmouseenter]","[onmouseleave]"],n=[];for(const e of t){document.querySelectorAll(e).forEach(e=>{document.body.contains(e)&&n.push(e)})}y=n,f=e,g.debug("[ElementCache] Updated interactive elements cache:",n.length,"elements")}return y}();g.debug("[ElementFinder] Found",n.length,"interactive elements (cached)");let o=null,i=-1/0;for(const s of n){const n=getElementBounds(s);if(e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom){g.debug("[ElementFinder] HIT:",s.tagName,s.id||s.className,"rect:",Math.round(n.left),Math.round(n.top),Math.round(n.right),Math.round(n.bottom));const e=window.getComputedStyle(s),t="auto"===e.zIndex?0:parseInt(e.zIndex);g.debug("[ElementFinder]   zIndex:",t),t>=i&&(i=t,o=s)}}return o?g.debug("[ElementFinder] Selected element:",o.tagName,o.id||o.className,"zIndex:",i):g.debug("[ElementFinder] No interactive element found at coordinates"),o})(n.x,n.y);const i=new MouseEvent(e.eventType,t);o?(g.debug("[DOMDispatch] Dispatching",e.eventType,"to element:",o.tagName,o.id||o.className),o.dispatchEvent(i)):(g.debug("[DOMDispatch] Dispatching",e.eventType,"to document (no element found)"),document.dispatchEvent(i));"mousedown"===e.eventType?g.info("[DOMDispatch] mousedown dispatched to",o?o.tagName+"#"+(o.id||"?"):"document"):"mouseup"===e.eventType?g.info("[DOMDispatch] mouseup dispatched to",o?o.tagName+"#"+(o.id||"?"):"document"):"click"===e.eventType&&g.info("[DOMDispatch] click dispatched to",o?o.tagName+"#"+(o.id||"?"):"document");const s=new CustomEvent("AnyWP:mouse",{detail:{type:e.eventType,x:e.x,y:e.y,button:e.button||0}});if(window.dispatchEvent(s),"mouseup"===e.eventType){const t=new CustomEvent("AnyWP:click",{detail:{x:e.x,y:e.y}});window.dispatchEvent(t)}}(e,o,n)}catch(e){g.error("Error handling mouse event:",e)}}(t)}catch(e){g.error("Error handling WebMessage:",e)}else g.warn("Received empty WebMessage")}const v=function(e,t){let n=0,o=null;return function(...i){const s=Date.now(),r=s-n;r>=t?(n=s,e.apply(this,i)):(null!==o&&clearTimeout(o),o=window.setTimeout(()=>{n=Date.now(),e.apply(this,i),o=null},t-r))}}((e,t)=>{const n=new MouseEvent("mousemove",e);document.dispatchEvent(n),window._mousemove_count=(window._mousemove_count||0)+1,window._mousemove_count%50==0&&g.debug("[DOMDispatch] mousemove #"+window._mousemove_count+" at viewport ("+Math.round(e.clientX)+","+Math.round(e.clientY)+")");const o=new CustomEvent("AnyWP:mouse",{detail:{type:"mousemove",x:t.x,y:t.y,button:t.button||0}});window.dispatchEvent(o)},16);function getElementBounds(e){const t=Date.now(),n=h.get(e);if(n&&t-n.timestamp<100)return n.bounds;const o=e.getBoundingClientRect();return h.set(e,{bounds:o,timestamp:t}),o}function sendToFlutter(e,t={}){if(!window.chrome?.webview)return g.warn("chrome.webview not available, cannot send message to Flutter"),!1;const n={type:e,timestamp:Date.now(),data:t};g.info("[SendToFlutter] Sending message:",e),g.debug("[SendToFlutter] Message data:",n);try{return window.chrome.webview.postMessage(n),!0}catch(e){return g.error("[SendToFlutter] Error sending message:",e),!1}}function setupFlutterMessageListener(){g.info("Setting up Flutter message listener"),window.addEventListener("AnyWP:message",e=>{const t=e.detail;g.info("[FlutterMessage] Received message from Flutter:",t?.type||"unknown"),g.debug("[FlutterMessage] Message details:",t);const n=window.AnyWP;if(n&&n._onFlutterMessage)try{n._onFlutterMessage(t)}catch(e){g.error("[FlutterMessage] Error in user message handler:",e)}}),g.info("Flutter message listener setup complete")}const b={setup:function(){if(!window.chrome||!window.chrome.webview)return void g.info("chrome.webview not available");const e=window;e._anywpEarlyMessageListenerRegistered?g.warn("WebMessage listener already registered (EARLY), skipping duplicate"):(g.info("Setting up WebMessage listener (EARLY)"),e._anywpEarlyMessageListenerRegistered=!0,window.chrome.webview.addEventListener("message",handleWebMessage),g.info("WebMessage listener setup complete (EARLY)"))},setupFlutterListener:setupFlutterMessageListener,sendToFlutter:sendToFlutter};function initializeAnyWP(e){!function(){if("undefined"!=typeof window&&window.location){const e=new URLSearchParams(window.location.search).get("loglevel");if(e&&e.toUpperCase()in u){const t=u[e.toUpperCase()];return void m.setLevel(t)}}if("undefined"!=typeof window&&window.localStorage)try{const e=localStorage.getItem("anywp_loglevel");if(e&&e.toUpperCase()in u){const t=u[e.toUpperCase()];return void m.setLevel(t)}}catch(e){}const e="undefined"!=typeof window&&("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname);m.setLevel(e?u.DEBUG:u.INFO)}(),m.info("========================================"),m.info("AnyWP Engine v"+e.version+" (Simple Mode)"),m.info("========================================"),m.info("Screen: "+e.screenWidth+"x"+e.screenHeight),m.info("DPI Scale: "+e.dpiScale+"x"),m.info("========================================"),n.detectFromURL(),i.detect(e,r),o.setup(e,r,a),function(e){e._log("[Wallpaper] Initializing wallpaper controller...");try{document.addEventListener("mousedown",handleMouseDown,{capture:!0,passive:!0}),document.addEventListener("mouseup",handleMouseUp,{capture:!0,passive:!0}),document.addEventListener("mousemove",handleMouseMove$1,{capture:!0,passive:!0}),e._log("[Wallpaper] Wallpaper controller initialized successfully",!0),window.AnyWP.Wallpaper={setInteractive:setInteractive,forceMouseOverEvent:forceMouseOverEvent,getState:()=>({isInteractive:d,lastMouseX:l,lastMouseY:c})}}catch(t){e._log("[Wallpaper] ERROR initializing controller: "+t,!0)}}(e),setupFlutterMessageListener(),e.sendToFlutter=sendToFlutter,m.info("Bidirectional communication enabled (Flutter â†” JavaScript)"),e._debugMode=!0,m.info("Debug mode ENABLED automatically")}const _=m.scope("Storage"),W={load(e,t,n){if(_.debug("Loading state for key:",t),e._persistedState[t])return _.debug("Found in cache:",e._persistedState[t]),void n(e._persistedState[t]);if(window.chrome?.webview){_.debug("Requesting state from native layer...");let o,i=!1;const handler=s=>{if(s.detail&&"stateLoaded"===s.detail.type&&s.detail.key===t){_.debug("Received stateLoaded event:",s.detail),window.removeEventListener("AnyWP:stateLoaded",handler),void 0!==o&&clearTimeout(o),i=!0;const r=s.detail.value?JSON.parse(s.detail.value):null;e._persistedState[t]=r,_.info("State loaded successfully:",r),n(r)}};window.addEventListener("AnyWP:stateLoaded",handler),window.chrome.webview.postMessage({type:"loadState",key:t}),o=window.setTimeout(()=>{i||(window.removeEventListener("AnyWP:stateLoaded",handler),_.warn("loadState timeout for key:",t),n(null))},1e3)}else{_.warn("chrome.webview not available, using localStorage");try{const o=localStorage.getItem("AnyWP_"+t),i=o?JSON.parse(o):null;e._persistedState[t]=i,_.info("Loaded from localStorage:",i),n(i)}catch(e){_.error("Failed to load state:",e),n(null)}}},save(e,t,o){if(e._persistedState[t]=o,window.chrome?.webview)window.chrome.webview.postMessage({type:"saveState",key:t,value:JSON.stringify(o)}),n.log("Saved state for "+t);else try{localStorage.setItem("AnyWP_"+t,JSON.stringify(o)),n.log("Saved state to localStorage for "+t)}catch(e){console.warn("[AnyWP] Failed to save state:",e)}},clear(e){if(e._persistedState={},window.chrome?.webview)window.chrome.webview.postMessage({type:"clearState"}),n.log("Cleared all saved state");else try{Object.keys(localStorage).forEach(e=>{e.startsWith("AnyWP_")&&localStorage.removeItem(e)}),n.log("Cleared localStorage state")}catch(e){console.warn("[AnyWP] Failed to clear state:",e)}},saveElementPosition(e,t,n,o){const i={left:n,top:o};if(_.debug("Saving position for "+t+": ",i),e._persistedState[t]=i,window.chrome?.webview){const e={type:"saveState",key:t,value:JSON.stringify(i)};_.debug("Sending saveState message:",e),window.chrome.webview.postMessage(e),_.debug("Message sent successfully")}else{_.warn("chrome.webview not available, using localStorage");try{localStorage.setItem("AnyWP_"+t,JSON.stringify(i)),_.info("Saved to localStorage for "+t)}catch(e){_.error("Failed to save state:",e)}}}};return t._init=function(){initializeAnyWP(this)},t.enableDebug=function(){n.enable()},t._log=function(e,t){n.log(e,t)},t.log=function(e){n.log(e,!0),window.chrome&&window.chrome.webview&&window.chrome.webview.postMessage({type:"log",message:e})},t.onClick=function(e,t,n){r.onClick(this,e,t,n)},t.refreshBounds=function(){return r.refreshBounds(this)},t.clearHandlers=function(){r.clearHandlers(this)},t.saveState=function(e,t){W.save(this,e,t)},t.loadState=function(e,t){W.load(this,e,t)},t.clearState=function(){W.clear(this)},t.onMouse=function(e){o.onMouse(this,e)},t.onKeyboard=function(e){o.onKeyboard(this,e)},t.onVisibilityChange=function(e){o.onVisibilityChange(this,e)},t._notifyVisibilityChange=function(e){o.notifyVisibilityChange(this,e)},t.setSPAMode=function(e){i.setSPAMode(this,r,e)},"undefined"!=typeof window&&(b.setup(),void 0!==window.AnyWP?(console.info("[AnyWP] SDK already loaded, skipping re-initialization"),console.info("[AnyWP] This is expected when C++ plugin injects SDK multiple times")):(console.info("[AnyWP] Initializing SDK for the first time"),window.AnyWP=t,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t._init()}):t._init(),console.info("[AnyWP] SDK loaded successfully"))),e.AnyWP=t,e}({});
//# sourceMappingURL=anywp_sdk.min.js.map
