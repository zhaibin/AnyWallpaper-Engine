<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>C++ 注入测试 - 无 script 标签</title>
  <!-- 注意：这个页面故意不包含 <script src> 标签 -->
  <!-- 完全依赖 C++ 注入 SDK -->
  <style>
    body {
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: monospace;
      color: white;
    }

    #report {
      background: rgba(0,0,0,0.9);
      padding: 40px;
      border-radius: 15px;
      text-align: center;
      font-size: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    }

    .success { color: #0f0; font-size: 32px; font-weight: bold; margin: 20px 0; }
    .fail { color: #f00; font-size: 32px; font-weight: bold; margin: 20px 0; }
    .info { color: #0ff; margin: 10px 0; }
    .warn { color: #ff0; margin: 10px 0; }

    #box {
      position: absolute;
      left: 100px;
      top: 400px;
      width: 200px;
      height: 150px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border: 4px solid #ffff00;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      cursor: move;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>
  <div id="report">
    <div class="warn">⏳ 检查中...</div>
    <div id="result"></div>
  </div>

  <div id="box">测试拖拽</div>

  <script>
    const result = document.getElementById('result');
    
    function showResult(success, message, details) {
      result.innerHTML = `
        <div class="${success ? 'success' : 'fail'}">${success ? '✓ 成功' : '× 失败'}</div>
        <div class="info">${message}</div>
        ${details ? '<div class="info" style="font-size:14px; margin-top:20px;">' + details + '</div>' : ''}
      `;
    }

    // 等待 1 秒后检查
    setTimeout(function() {
      if (window.AnyWP) {
        const version = window.AnyWP.version;
        const hasDrag = typeof window.AnyWP.makeDraggable === 'function';
        
        if (hasDrag && version.startsWith('4.2')) {
          showResult(true, 
                    'C++ 注入成功！', 
                    'SDK版本: ' + version + '<br>makeDraggable: 存在<br>可以拖拽下方黄色方块');
          
          // 设置拖拽
          window.AnyWP.interactionEnabled = true;
          window.AnyWP.makeDraggable('#box', {
            persistKey: 'inject_test_box',
            onDragStart: function() {
              console.log('拖拽开始');
            }
          });
        } else {
          showResult(false, 
                    'C++ 注入部分成功',
                    'SDK版本: ' + version + '<br>makeDraggable: ' + (hasDrag ? '存在' : '不存在') + '<br>可能使用了旧版 SDK');
        }
      } else {
        showResult(false, 
                  'C++ 注入失败',
                  'window.AnyWP 不存在<br>SDK 完全没有加载');
      }
    }, 1000);
  </script>
</body>
</html>

