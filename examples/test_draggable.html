<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AnyWP æ‹–æ‹½æµ‹è¯•</title>
  
  <!-- ç›´æ¥åŠ è½½ SDK æ–‡ä»¶ -->
  <script src="../windows/anywp_sdk.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .info-panel {
      background: rgba(255,255,255,0.95);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }

    .info-panel h2 {
      margin-top: 0;
      color: #667eea;
      font-size: 20px;
    }

    .info-panel p {
      margin: 10px 0;
      color: #333;
      line-height: 1.6;
    }

    .draggable-box {
      width: 200px;
      height: 150px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transition: transform 0.2s, box-shadow 0.2s;
      position: absolute;
      left: 100px;
      top: 200px;
    }

    .draggable-box:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 40px rgba(0,0,0,0.4);
    }

    .draggable-box.dragging {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }

    .widget-card {
      width: 250px;
      height: 180px;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      position: absolute;
      cursor: move;
    }

    .widget-card h3 {
      margin: 0 0 10px 0;
      color: #667eea;
      font-size: 18px;
    }

    .widget-card p {
      margin: 5px 0;
      color: #666;
      font-size: 14px;
    }

    .widget-card .time {
      font-size: 32px;
      font-weight: bold;
      color: #333;
      margin: 15px 0;
    }

    #widget1 {
      left: 400px;
      top: 200px;
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    }

    #widget2 {
      left: 700px;
      top: 200px;
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    }

    .status {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      font-family: monospace;
      font-size: 12px;
      max-width: 300px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      z-index: 9999;
    }

    .status div {
      margin: 5px 0;
    }

    .button-group {
      text-align: center;
      margin-top: 20px;
    }

    .btn {
      padding: 12px 30px;
      margin: 0 10px;
      border: 3px solid transparent;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      user-select: none;
    }

    .btn:active {
      transform: translateY(2px) scale(0.98);
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);
      border-color: #fff;
    }

    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border-color: #f093fb;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(245, 87, 108, 0.5);
      border-color: #fff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ AnyWP æ‹–æ‹½åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="info-panel" style="background: rgba(200,255,200,0.95);">
      <h2>âœ¨ äº’åŠ¨å£çº¸æ‹–æ‹½æµ‹è¯•</h2>
      <p><strong>ğŸ¯ æ¶æ„ç‰¹æ€§ï¼š</strong>åŸºäºé¼ æ ‡é’©å­å®ç°ï¼Œ<strong style="color: #4CAF50;">ä¿æŒé¼ æ ‡é€æ˜</strong>çš„åŒæ—¶æ”¯æŒæ‹–æ‹½ï¼</p>
      <p><strong>ğŸ“ ä½¿ç”¨æ–¹æ³•ï¼š</strong>åœ¨ Flutter åº”ç”¨ä¸­ç‚¹å‡» "Start" å¯åŠ¨å£çº¸ï¼Œç„¶åç›´æ¥æ‹–åŠ¨ä¸‹æ–¹å…ƒç´ </p>
      <p><strong>ğŸ’¡ æŠ€æœ¯äº®ç‚¹ï¼š</strong>å£çº¸åœ¨æ¡Œé¢å›¾æ ‡ä¸‹æ–¹ï¼Œé€šè¿‡ C++ é¼ æ ‡é’©å­æ•è·äº‹ä»¶å¹¶è½¬å‘åˆ° WebView2</p>
    </div>

    <div class="info-panel">
      <h2>ğŸ“Œ åŠŸèƒ½è¯´æ˜</h2>
      <p><strong>âœ… äº¤äº’æ¨¡å¼ï¼š</strong>é»˜è®¤å·²å¯ç”¨</p>
      <p><strong>ğŸ–±ï¸ æ‹–æ‹½å…ƒç´ ï¼š</strong>æ‹–åŠ¨å½©è‰²æ–¹å—æˆ–å¡ç‰‡åˆ°ä»»æ„ä½ç½®</p>
      <p><strong>ğŸ’¾ è‡ªåŠ¨ä¿å­˜ï¼š</strong>å…ƒç´ ä½ç½®è‡ªåŠ¨ä¿å­˜åˆ° Windows Registry</p>
      <p><strong>ğŸ”„ è‡ªåŠ¨æ¢å¤ï¼š</strong>é‡æ–°æ‰“å¼€å£çº¸åæ¢å¤åˆ°ä¸Šæ¬¡çš„ä½ç½®</p>
      <p><strong>ğŸ–¼ï¸ é¼ æ ‡ç©¿é€ï¼š</strong>ä¸åœ¨å…ƒç´ ä¸Šæ—¶ï¼Œç‚¹å‡»ä¼šç©¿é€åˆ°æ¡Œé¢å›¾æ ‡</p>
    </div>

    <div class="button-group">
      <button id="toggleBtn" class="btn btn-danger">ç¦ç”¨äº¤äº’æ¨¡å¼</button>
      <button id="clearBtn" class="btn btn-primary">æ¸…é™¤æ‰€æœ‰çŠ¶æ€</button>
    </div>
  </div>

  <!-- å¯æ‹–æ‹½å…ƒç´  -->
  <div id="box1" class="draggable-box">
    æ‹–åŠ¨æˆ‘ #1<br>
    <small>ä½ç½®ä¼šè‡ªåŠ¨ä¿å­˜</small>
  </div>

  <div id="widget1" class="widget-card">
    <h3>ğŸ“Š æ•°æ®é¢æ¿</h3>
    <p>æ‹–åŠ¨æˆ‘åˆ°ä»»æ„ä½ç½®</p>
    <div class="time" id="time1">--:--</div>
    <p>ä½ç½®ä¼šè‡ªåŠ¨ä¿å­˜</p>
  </div>

  <div id="widget2" class="widget-card">
    <h3>ğŸµ éŸ³ä¹æ’­æ”¾å™¨</h3>
    <p>æ‹–åŠ¨æˆ‘åˆ°ä»»æ„ä½ç½®</p>
    <div class="time" id="music-status">â™ª æš‚åœ</div>
    <p>çŠ¶æ€ä¼šè‡ªåŠ¨ä¿å­˜</p>
  </div>

  <!-- çŠ¶æ€æ˜¾ç¤º -->
  <div class="status" id="status">
    <div style="font-weight: bold; color: #4CAF50;">ğŸ¯ AnyWP Engine v4.2.0</div>
    <div id="interaction-status">â³ ç­‰å¾… SDK åŠ è½½...</div>
    <div id="drag-status">ğŸ“ æ‹–æ‹½çŠ¶æ€: åˆå§‹åŒ–ä¸­</div>
    <div id="save-status">ğŸ’¾ ä¿å­˜çŠ¶æ€: å°±ç»ª</div>
    <div id="mouse-status" style="color: #ff9800;">ğŸ–±ï¸ é¼ æ ‡é€æ˜: è¯·æ£€æŸ¥è®¾ç½®</div>
  </div>

  <script>
    // é»˜è®¤å¯ç”¨äº¤äº’æ¨¡å¼ï¼Œè¿™æ ·ç”¨æˆ·ç¦ç”¨é¼ æ ‡é€æ˜åå°±å¯ä»¥ç›´æ¥æ‹–æ‹½
    let interactionEnabled = true;
    let currentTime = new Date();

    // æ›´æ–°æ—¶é’Ÿ
    function updateClock() {
      currentTime = new Date();
      const hours = String(currentTime.getHours()).padStart(2, '0');
      const minutes = String(currentTime.getMinutes()).padStart(2, '0');
      document.getElementById('time1').textContent = `${hours}:${minutes}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // åˆ‡æ¢äº¤äº’æ¨¡å¼
    function toggleInteraction() {
      interactionEnabled = !interactionEnabled;
      
      console.log('[Test] Interaction mode toggled to:', interactionEnabled);
      
      const btn = document.getElementById('toggleBtn');
      if (interactionEnabled) {
        btn.textContent = 'ç¦ç”¨äº¤äº’æ¨¡å¼';
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-danger');
        document.getElementById('interaction-status').innerHTML = 'âœ… äº¤äº’æ¨¡å¼: å·²å¯ç”¨';
        document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: å°±ç»ªï¼ˆå¯ä»¥æ‹–æ‹½äº†ï¼‰';
      } else {
        btn.textContent = 'å¯ç”¨äº¤äº’æ¨¡å¼';
        btn.classList.remove('btn-danger');
        btn.classList.add('btn-primary');
        document.getElementById('interaction-status').innerHTML = 'âŒ äº¤äº’æ¨¡å¼: æœªå¯ç”¨';
        document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: ç©ºé—²';
      }

      // åŒæ­¥ AnyWP.interactionEnabled
      if (window.AnyWP) {
        AnyWP.interactionEnabled = interactionEnabled;
        console.log('[Test] AnyWP.interactionEnabled set to:', AnyWP.interactionEnabled);
      }
    }

    // æ¸…é™¤æ‰€æœ‰çŠ¶æ€
    function clearAllState() {
      if (window.AnyWP && window.AnyWP.clearState) {
        AnyWP.clearState();
        document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: å·²æ¸…é™¤';
        
        // é‡ç½®æ‰€æœ‰å…ƒç´ ä½ç½®
        document.getElementById('box1').style.left = '100px';
        document.getElementById('box1').style.top = '200px';
        document.getElementById('widget1').style.left = '400px';
        document.getElementById('widget1').style.top = '200px';
        document.getElementById('widget2').style.left = '700px';
        document.getElementById('widget2').style.top = '200px';
        
        setTimeout(() => {
          document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: å°±ç»ª';
        }, 2000);
      } else {
        alert('AnyWP SDK æœªåŠ è½½æˆ–ä¸æ”¯æŒçŠ¶æ€ç®¡ç†');
      }
    }

    // ç­‰å¾… AnyWP SDK åŠ è½½
    function waitForAnyWP() {
      if (window.AnyWP) {
        console.log('[Test] AnyWP SDK v' + AnyWP.version + ' detected');
        console.log('[Test] Available methods:', Object.keys(AnyWP));
        
        // åŠ è½½ä¿å­˜çš„çŠ¶æ€
        loadSavedStates();
        
        // è®¾ç½®å¯æ‹–æ‹½å…ƒç´ 
        setupDraggable();
        
        // è®¾ç½®æŒ‰é’®ç‚¹å‡»å¤„ç†
        setupButtons();
        
        // é»˜è®¤å¯ç”¨äº¤äº’æ¨¡å¼
        if (window.AnyWP) {
          AnyWP.interactionEnabled = true;
          console.log('[Test] AnyWP.interactionEnabled initialized to: true');
        }
        
        document.getElementById('interaction-status').innerHTML = 
          'âœ… SDK å·²åŠ è½½ - äº¤äº’å·²å¯ç”¨';
        document.getElementById('drag-status').innerHTML = 
          'ğŸ“ æ‹–æ‹½çŠ¶æ€: å°±ç»ªï¼ˆå¯ä»¥æ‹–æ‹½ï¼‰';
        document.getElementById('mouse-status').innerHTML = 
          'ğŸ–±ï¸ é¼ æ ‡é’©å­: å·²æ¿€æ´»ï¼ˆæ”¯æŒé€æ˜çª—å£ï¼‰';
      } else {
        console.log('[Test] Waiting for AnyWP SDK...');
        setTimeout(waitForAnyWP, 100);
      }
    }
    
    // è®¾ç½®æŒ‰é’®ç‚¹å‡»ï¼ˆä½¿ç”¨ AnyWP.onClickï¼‰
    function setupButtons() {
      if (window.AnyWP && window.AnyWP.onClick) {
        console.log('[Test] Setting up button click handlers via AnyWP.onClick');
        
        // æ³¨å†ŒæŒ‰é’®ç‚¹å‡»åŒºåŸŸ
        AnyWP.onClick('#toggleBtn', function(x, y) {
          console.log('[Test] Toggle button clicked at:', x, y);
          toggleInteraction();
        }, { immediate: true, debug: true });
        
        AnyWP.onClick('#clearBtn', function(x, y) {
          console.log('[Test] Clear button clicked at:', x, y);
          clearAllState();
        }, { immediate: true, debug: true });
        
        console.log('[Test] Button click handlers registered');
      } else {
        console.log('[Test] Using fallback button handlers (standard DOM events)');
        
        // Fallback: ä½¿ç”¨æ ‡å‡† DOM äº‹ä»¶
        document.getElementById('toggleBtn').addEventListener('click', function() {
          console.log('[Test] Toggle button clicked (fallback)');
          toggleInteraction();
        });
        
        document.getElementById('clearBtn').addEventListener('click', function() {
          console.log('[Test] Clear button clicked (fallback)');
          clearAllState();
        });
      }
    }

    // åŠ è½½ä¿å­˜çš„çŠ¶æ€
    function loadSavedStates() {
      if (!window.AnyWP || !window.AnyWP.loadState) {
        console.log('[Test] State management not available');
        return;
      }

      // åŠ è½½æ¯ä¸ªå…ƒç´ çš„ä½ç½®
      ['box1', 'widget1', 'widget2'].forEach(id => {
        AnyWP.loadState(id + '_position', function(state) {
          if (state) {
            console.log('[Test] Loaded state for ' + id + ':', state);
            const element = document.getElementById(id);
            if (element) {
              element.style.left = state.left + 'px';
              element.style.top = state.top + 'px';
            }
          }
        });
      });
    }

    // è®¾ç½®å¯æ‹–æ‹½å…ƒç´ 
    function setupDraggable() {
      if (!window.AnyWP || !window.AnyWP.makeDraggable) {
        console.log('[Test] Drag support not available, using fallback');
        setupFallbackDrag();
        return;
      }

      console.log('[Test] Setting up draggable elements with AnyWP SDK');

      // è®¾ç½®æ‹–æ‹½ - Box 1
      AnyWP.makeDraggable('#box1', {
        persistKey: 'box1_position',
        onDragStart: function(pos) {
          console.log('[Test] Box1 drag start:', pos);
          document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: æ‹–åŠ¨ä¸­ (Box1)';
          document.getElementById('box1').classList.add('dragging');
        },
        onDrag: function(pos) {
          // å®æ—¶æ›´æ–°ä½ç½®æ˜¾ç¤º
        },
        onDragEnd: function(pos) {
          console.log('[Test] Box1 drag end:', pos);
          document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: ç©ºé—²';
          document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: å·²ä¿å­˜ Box1 ä½ç½®';
          document.getElementById('box1').classList.remove('dragging');
          
          setTimeout(() => {
            document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: å°±ç»ª';
          }, 2000);
        }
      });

      // è®¾ç½®æ‹–æ‹½ - Widget 1
      AnyWP.makeDraggable('#widget1', {
        persistKey: 'widget1_position',
        onDragStart: function(pos) {
          console.log('[Test] Widget1 drag start:', pos);
          document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: æ‹–åŠ¨ä¸­ (Widget1)';
        },
        onDragEnd: function(pos) {
          console.log('[Test] Widget1 drag end:', pos);
          document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: ç©ºé—²';
          document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: å·²ä¿å­˜ Widget1 ä½ç½®';
          
          setTimeout(() => {
            document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: å°±ç»ª';
          }, 2000);
        }
      });

      // è®¾ç½®æ‹–æ‹½ - Widget 2
      AnyWP.makeDraggable('#widget2', {
        persistKey: 'widget2_position',
        onDragStart: function(pos) {
          console.log('[Test] Widget2 drag start:', pos);
          document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: æ‹–åŠ¨ä¸­ (Widget2)';
        },
        onDragEnd: function(pos) {
          console.log('[Test] Widget2 drag end:', pos);
          document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: ç©ºé—²';
          document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: å·²ä¿å­˜ Widget2 ä½ç½®';
          
          setTimeout(() => {
            document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: å°±ç»ª';
          }, 2000);
        }
      });

      console.log('[Test] All draggable elements initialized');
    }

    // Fallback æ‹–æ‹½å®ç°ï¼ˆç”¨äºæµ‹è¯•ï¼‰
    function setupFallbackDrag() {
      console.log('[Test] Using fallback drag implementation');
      
      ['box1', 'widget1', 'widget2'].forEach(id => {
        const element = document.getElementById(id);
        let isDragging = false;
        let offsetX, offsetY;

        element.addEventListener('mousedown', function(e) {
          if (!interactionEnabled) return;
          
          isDragging = true;
          offsetX = e.clientX - element.offsetLeft;
          offsetY = e.clientY - element.offsetTop;
          element.style.cursor = 'grabbing';
          
          document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: æ‹–åŠ¨ä¸­ (' + id + ')';
        });

        document.addEventListener('mousemove', function(e) {
          if (!isDragging) return;
          
          element.style.left = (e.clientX - offsetX) + 'px';
          element.style.top = (e.clientY - offsetY) + 'px';
        });

        document.addEventListener('mouseup', function(e) {
          if (!isDragging) return;
          
          isDragging = false;
          element.style.cursor = 'move';
          
          document.getElementById('drag-status').innerHTML = 'ğŸ“ æ‹–æ‹½çŠ¶æ€: ç©ºé—²';
          document.getElementById('save-status').innerHTML = 'ğŸ’¾ ä¿å­˜çŠ¶æ€: Fallback æ¨¡å¼ (ä¸ä¿å­˜)';
          
          console.log('[Test] ' + id + ' position:', element.offsetLeft, element.offsetTop);
        });
      });
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', waitForAnyWP);
    } else {
      waitForAnyWP();
    }
  </script>
</body>
</html>

