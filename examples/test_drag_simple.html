<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ‹–æ‹½è°ƒè¯•æµ‹è¯•</title>
  
  <!-- ç›´æ¥åŠ è½½ SDK æ–‡ä»¶ -->
  <script src="../windows/anywp_sdk.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .debug-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.9);
      color: #0f0;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 10000;
    }

    .debug-panel .log {
      margin: 2px 0;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .box {
      position: absolute;
      left: 100px;
      top: 100px;
      width: 200px;
      height: 150px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      font-weight: bold;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      cursor: move;
    }

    .info {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.95);
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
    }

    .info h2 {
      margin-top: 0;
      color: #667eea;
    }
  </style>
</head>
<body>
  <div class="info">
    <h2>ğŸ” æ‹–æ‹½è°ƒè¯•æµ‹è¯•</h2>
    <p><strong>ç›®çš„ï¼š</strong>è¯Šæ–­æ‹–æ‹½åŠŸèƒ½é—®é¢˜</p>
    <p><strong>æŸ¥çœ‹ï¼š</strong>å³ä¾§é»‘è‰²é¢æ¿æ˜¾ç¤ºæ‰€æœ‰äº‹ä»¶æ—¥å¿—</p>
    <p><strong>æ“ä½œï¼š</strong>å°è¯•æ‹–åŠ¨ç²‰è‰²æ–¹å—</p>
  </div>

  <div id="dragBox" class="box">
    æ‹–åŠ¨æˆ‘ï¼
  </div>

  <div class="debug-panel" id="debugPanel">
    <div class="log" style="color: #ff0;">===== è°ƒè¯•æ—¥å¿— =====</div>
  </div>

  <script>
    const debugPanel = document.getElementById('debugPanel');
    let logCount = 0;
    const MAX_LOGS = 50;

    function log(message, color = '#0f0') {
      console.log('[DEBUG] ' + message);
      const logDiv = document.createElement('div');
      logDiv.className = 'log';
      logDiv.style.color = color;
      logDiv.textContent = `[${++logCount}] ${message}`;
      debugPanel.appendChild(logDiv);
      
      // é™åˆ¶æ—¥å¿—æ•°é‡
      while (debugPanel.children.length > MAX_LOGS) {
        debugPanel.removeChild(debugPanel.children[1]); // ä¿ç•™æ ‡é¢˜
      }
      
      // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
      debugPanel.scrollTop = debugPanel.scrollHeight;
    }

    log('é¡µé¢åŠ è½½å®Œæˆ', '#ff0');
    log('DPI: ' + window.devicePixelRatio, '#0ff');

    // æ£€æŸ¥ AnyWP SDK
    function checkAnyWP() {
      if (window.AnyWP) {
        log('âœ… AnyWP SDK å·²åŠ è½½', '#0f0');
        log('ç‰ˆæœ¬: ' + AnyWP.version, '#0ff');
        log('DPI Scale: ' + AnyWP.dpiScale, '#0ff');
        log('Screen: ' + AnyWP.screenWidth + 'x' + AnyWP.screenHeight, '#0ff');
        log('äº¤äº’å¯ç”¨: ' + AnyWP.interactionEnabled, '#0ff');
        
        // æ£€æŸ¥ makeDraggable æ–¹æ³•
        if (typeof AnyWP.makeDraggable === 'function') {
          log('âœ… makeDraggable æ–¹æ³•å­˜åœ¨', '#0f0');
          setupDrag();
        } else {
          log('âŒ makeDraggable æ–¹æ³•ä¸å­˜åœ¨', '#f00');
        }
      } else {
        log('â³ ç­‰å¾… AnyWP SDK...', '#ff0');
        setTimeout(checkAnyWP, 100);
      }
    }

    // ç›‘å¬åŸç”Ÿé¼ æ ‡äº‹ä»¶
    let mouseEventCount = 0;
    window.addEventListener('AnyWP:mouse', function(event) {
      mouseEventCount++;
      const detail = event.detail;
      
      // åªè®°å½•æ¯10ä¸ªäº‹ä»¶æˆ–é mousemove äº‹ä»¶
      if (detail.type !== 'mousemove' || mouseEventCount % 10 === 0) {
        log(`ğŸ–±ï¸ AnyWP:mouse - ${detail.type} (${detail.x}, ${detail.y})`, '#ff0');
      }
    });

    // è®¾ç½®æ‹–æ‹½
    function setupDrag() {
      log('å¼€å§‹è®¾ç½®æ‹–æ‹½...', '#0ff');
      
      // å¯ç”¨äº¤äº’æ¨¡å¼
      AnyWP.interactionEnabled = true;
      log('äº¤äº’æ¨¡å¼å·²å¯ç”¨', '#0f0');
      
      const box = document.getElementById('dragBox');
      
      try {
        AnyWP.makeDraggable('#dragBox', {
          persistKey: 'test_box_position',
          onDragStart: function(pos) {
            log('ğŸ¯ æ‹–æ‹½å¼€å§‹: (' + pos.x + ', ' + pos.y + ')', '#0f0');
          },
          onDrag: function(pos) {
            // ä¸è®°å½•æ¯æ¬¡æ‹–æ‹½ï¼Œå¤ªå¤šäº†
          },
          onDragEnd: function(pos) {
            log('ğŸ¯ æ‹–æ‹½ç»“æŸ: (' + pos.x + ', ' + pos.y + ')', '#0f0');
          }
        });
        
        log('âœ… makeDraggable è°ƒç”¨æˆåŠŸ', '#0f0');
        
        // æ£€æŸ¥æ˜¯å¦æ³¨å†Œäº†äº‹ä»¶å¤„ç†å™¨
        if (box.__anyWP_dragHandler) {
          log('âœ… æ‹–æ‹½å¤„ç†å™¨å·²æ³¨å†Œ', '#0f0');
        } else {
          log('âŒ æ‹–æ‹½å¤„ç†å™¨æœªæ³¨å†Œ', '#f00');
        }
      } catch (e) {
        log('âŒ makeDraggable å‡ºé”™: ' + e.message, '#f00');
        log('Stack: ' + e.stack, '#f00');
      }
    }

    // Fallback: æ ‡å‡† DOM äº‹ä»¶ï¼ˆç”¨äºå¯¹æ¯”æµ‹è¯•ï¼‰
    const box = document.getElementById('dragBox');
    let isDragging = false;
    let startX, startY, initialLeft, initialTop;

    box.addEventListener('mousedown', function(e) {
      log('ğŸ–±ï¸ DOM mousedown è§¦å‘', '#0ff');
    });

    document.addEventListener('mousemove', function(e) {
      // ä¸è®°å½•ï¼Œå¤ªå¤šäº†
    });

    document.addEventListener('mouseup', function(e) {
      log('ğŸ–±ï¸ DOM mouseup è§¦å‘', '#0ff');
    });

    // å¼€å§‹æ£€æŸ¥
    log('å¼€å§‹æ£€æŸ¥ AnyWP SDK...', '#ff0');
    checkAnyWP();

    // å®šæ—¶æ£€æŸ¥çŠ¶æ€
    setInterval(function() {
      const info = {
        interactionEnabled: window.AnyWP ? window.AnyWP.interactionEnabled : 'N/A',
        dragState: window.AnyWP ? (window.AnyWP._dragState ? 'dragging' : 'idle') : 'N/A'
      };
      
      // åªåœ¨çŠ¶æ€å˜åŒ–æ—¶è®°å½•
      const infoStr = JSON.stringify(info);
      if (window._lastInfo !== infoStr) {
        log('ğŸ“Š çŠ¶æ€: ' + infoStr, '#aaa');
        window._lastInfo = infoStr;
      }
    }, 2000);
  </script>
</body>
</html>

