<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AnyWP - å…¨å±åº”ç”¨æš‚åœæµ‹è¯•</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      text-align: center;
      padding: 40px;
      max-width: 900px;
      width: 90%;
    }
    
    h1 {
      font-size: 48px;
      margin-bottom: 20px;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
    }
    
    .status-panel {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 30px;
      margin: 30px 0;
      border: 3px solid rgba(255,255,255,0.3);
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    
    .counter-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .counter-box {
      background: rgba(0,0,0,0.3);
      padding: 25px;
      border-radius: 15px;
      border: 2px solid;
    }
    
    .counter-box.pause {
      border-color: #ff9800;
    }
    
    .counter-box.resume {
      border-color: #4CAF50;
    }
    
    .counter-label {
      font-size: 16px;
      margin-bottom: 10px;
      opacity: 0.9;
    }
    
    .counter-value {
      font-size: 72px;
      font-weight: bold;
      text-shadow: 0 0 20px currentColor;
    }
    
    .pause .counter-value {
      color: #ff9800;
    }
    
    .resume .counter-value {
      color: #4CAF50;
    }
    
    .state-indicator {
      padding: 20px;
      background: rgba(0,0,0,0.4);
      border-radius: 12px;
      font-size: 24px;
      font-weight: bold;
    }
    
    .state-indicator.visible {
      color: #4CAF50;
    }
    
    .state-indicator.hidden {
      color: #ff9800;
    }
    
    .animation-demo {
      width: 100%;
      height: 200px;
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      position: relative;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .moving-circle {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #FFD700, #FF8C00);
      border-radius: 50%;
      position: absolute;
      top: 60px;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
    }
    
    .instructions {
      background: rgba(33, 150, 243, 0.3);
      border-left: 5px solid #2196F3;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: left;
    }
    
    .instructions h3 {
      margin-bottom: 10px;
      font-size: 20px;
    }
    
    .instructions ul {
      margin-left: 20px;
      line-height: 1.8;
    }
    
    .log-console {
      background: rgba(0,0,0,0.6);
      border-radius: 12px;
      padding: 15px;
      max-height: 250px;
      overflow-y: auto;
      font-family: 'Consolas', monospace;
      font-size: 13px;
      text-align: left;
      margin-top: 20px;
    }
    
    .log-entry {
      padding: 5px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .log-time {
      color: #888;
      margin-right: 10px;
    }
    
    .log-event {
      color: #4CAF50;
    }
    
    .log-warning {
      color: #ff9800;
    }
    
    .log-error {
      color: #f44336;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ å…¨å±åº”ç”¨æš‚åœæµ‹è¯•</h1>
    
    <div class="status-panel">
      <div class="counter-grid">
        <div class="counter-box pause">
          <div class="counter-label">â¸ï¸ æš‚åœæ¬¡æ•°</div>
          <div class="counter-value" id="pause-count">0</div>
        </div>
        <div class="counter-box resume">
          <div class="counter-label">â–¶ï¸ æ¢å¤æ¬¡æ•°</div>
          <div class="counter-value" id="resume-count">0</div>
        </div>
      </div>
      
      <div class="state-indicator visible" id="state-indicator">
        âœ… å£çº¸å¯è§ï¼ˆæ­£å¸¸è¿è¡Œï¼‰
      </div>
    </div>
    
    <div class="instructions">
      <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
      <ul>
        <li>âœ… ç¬¬1æ­¥ï¼šç¡®è®¤é¡µé¢åŠ è½½å®Œæˆï¼ˆçœ‹åˆ°ä¸‹æ–¹åŠ¨ç”»åœ†åœˆï¼‰</li>
        <li>ğŸ”´ ç¬¬2æ­¥ï¼šæ‰“å¼€ä¸€ä¸ªå…¨å±åº”ç”¨ï¼ˆæŒ‰ F11 å…¨å±æµè§ˆå™¨ã€æ¸¸æˆã€è§†é¢‘æ’­æ”¾å™¨ç­‰ï¼‰</li>
        <li>â¸ï¸ ç¬¬3æ­¥ï¼šè§‚å¯Ÿæš‚åœè®¡æ•°å™¨æ˜¯å¦ +1</li>
        <li>âœ… ç¬¬4æ­¥ï¼šé€€å‡ºå…¨å±ï¼ˆæŒ‰ ESC æˆ– F11ï¼‰</li>
        <li>â–¶ï¸ ç¬¬5æ­¥ï¼šè§‚å¯Ÿæ¢å¤è®¡æ•°å™¨æ˜¯å¦ +1</li>
        <li>ğŸ”„ ç¬¬6æ­¥ï¼šé‡å¤å¤šæ¬¡æµ‹è¯•</li>
      </ul>
    </div>
    
    <div class="animation-demo">
      <div class="moving-circle" id="circle"></div>
    </div>
    
    <div class="log-console" id="log-console"></div>
  </div>

  <script>
    // ===========================================
    // å…¨å±€çŠ¶æ€
    // ===========================================
    let pauseCount = 0;
    let resumeCount = 0;
    let currentVisibilityState = true;
    let animationId = null;
    let circlePosition = 0;
    
    const pauseCountEl = document.getElementById('pause-count');
    const resumeCountEl = document.getElementById('resume-count');
    const stateIndicatorEl = document.getElementById('state-indicator');
    const logConsoleEl = document.getElementById('log-console');
    const circle = document.getElementById('circle');
    
    // ===========================================
    // æ—¥å¿—è®°å½•
    // ===========================================
    function addLog(message, type = 'event') {
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="log-time">${time}</span><span class="log-${type}">${message}</span>`;
      logConsoleEl.insertBefore(entry, logConsoleEl.firstChild);
      
      // é™åˆ¶æ—¥å¿—æ¡æ•°
      while (logConsoleEl.children.length > 30) {
        logConsoleEl.removeChild(logConsoleEl.lastChild);
      }
      
      // åŒæ—¶è¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
      console.log(`[${time}] ${message}`);
    }
    
    // ===========================================
    // çŠ¶æ€æ›´æ–°
    // ===========================================
    function updateStatus(visible) {
      console.log('========== updateStatus CALLED ==========');
      console.log('New visible:', visible);
      console.log('Current state:', currentVisibilityState);
      
      // é˜²æ­¢é‡å¤è®¡æ•°
      if (currentVisibilityState === visible) {
        console.log('[Warning] State unchanged, skipping count');
        addLog('âš ï¸ çŠ¶æ€æœªå˜åŒ–ï¼Œè·³è¿‡è®¡æ•°', 'warning');
        return;
      }
      
      currentVisibilityState = visible;
      
      if (visible) {
        // æ¢å¤
        resumeCount++;
        resumeCountEl.textContent = resumeCount;
        stateIndicatorEl.textContent = 'âœ… å£çº¸å¯è§ï¼ˆæ­£å¸¸è¿è¡Œï¼‰';
        stateIndicatorEl.className = 'state-indicator visible';
        addLog(`âœ… æ¢å¤ +1 (å½“å‰: ${resumeCount})`, 'event');
        
        // é‡å¯åŠ¨ç”»
        if (!animationId && !window.__anyWP_rafPaused) {
          console.log('[Animation] Restarting...');
          animateCircle();
        }
      } else {
        // æš‚åœ
        pauseCount++;
        pauseCountEl.textContent = pauseCount;
        stateIndicatorEl.textContent = 'â¸ï¸ å£çº¸å·²æš‚åœï¼ˆçœç”µæ¨¡å¼ï¼‰';
        stateIndicatorEl.className = 'state-indicator hidden';
        addLog(`â¸ï¸ æš‚åœ +1 (å½“å‰: ${pauseCount})`, 'warning');
        
        // åœæ­¢åŠ¨ç”»
        if (animationId) {
          console.log('[Animation] Stopping...');
          cancelAnimationFrame(animationId);
          animationId = null;
        }
      }
      
      console.log('========== updateStatus COMPLETE ==========');
    }
    
    // ===========================================
    // åŠ¨ç”»æ§åˆ¶
    // ===========================================
    function animateCircle() {
      // æ£€æŸ¥æš‚åœæ ‡å¿—
      if (window.__anyWP_rafPaused) {
        console.log('[Animation] Stopped by pause flag');
        animationId = null;
        return;
      }
      
      circlePosition = (circlePosition + 3) % (window.innerWidth - 80);
      circle.style.left = circlePosition + 'px';
      animationId = requestAnimationFrame(animateCircle);
    }
    
    // ===========================================
    // SDK åˆå§‹åŒ–
    // ===========================================
    function initAnyWP() {
      console.log('========== INITIALIZING ANYWP SDK ==========');
      
      if (!window.AnyWP) {
        console.log('[SDK] Not ready yet, waiting...');
        addLog('â³ ç­‰å¾… SDK åŠ è½½...', 'warning');
        setTimeout(initAnyWP, 100);
        return;
      }
      
      console.log('[SDK] AnyWP detected, version:', AnyWP.version);
      addLog(`âœ… AnyWP SDK v${AnyWP.version} åŠ è½½å®Œæˆ`, 'event');
      
      // æ£€æŸ¥ _notifyVisibilityChange æ–¹æ³•
      if (typeof window.AnyWP._notifyVisibilityChange !== 'function') {
        console.error('[SDK] ERROR: _notifyVisibilityChange method NOT FOUND!');
        addLog('âŒ é”™è¯¯ï¼š_notifyVisibilityChange æ–¹æ³•ä¸å­˜åœ¨', 'error');
        return;
      } else {
        console.log('[SDK] âœ… _notifyVisibilityChange method exists');
        addLog('âœ… _notifyVisibilityChange æ–¹æ³•å¯ç”¨', 'event');
      }
      
      // æ³¨å†Œ visibility å›è°ƒ
      console.log('[SDK] Registering visibility callback...');
      AnyWP.onVisibilityChange(function(visible) {
        console.log('========== VISIBILITY CALLBACK TRIGGERED ==========');
        console.log('[Callback] Visible:', visible);
        addLog(`ğŸ”” Visibility å›è°ƒ: ${visible ? 'å¯è§' : 'éšè—'}`, 'event');
        updateStatus(visible);
      });
      console.log('[SDK] Visibility callback registered');
      addLog('âœ… Visibility å›è°ƒå·²æ³¨å†Œ', 'event');
      
      // ç›‘å¬ DOM äº‹ä»¶
      console.log('[SDK] Setting up DOM event listener...');
      window.addEventListener('AnyWP:visibility', function(event) {
        console.log('========== DOM EVENT RECEIVED ==========');
        console.log('[DOM Event] Detail:', event.detail);
        addLog(`ğŸ”” DOM äº‹ä»¶: ${event.detail.visible ? 'å¯è§' : 'éšè—'}`, 'event');
      });
      console.log('[SDK] DOM event listener set up');
      addLog('âœ… DOM äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®', 'event');
      
      // é€šçŸ¥å°±ç»ª
      AnyWP.ready('Fullscreen Pause Test Page');
      addLog('âœ… é¡µé¢å·²å°±ç»ª', 'event');
      
      // æµ‹è¯•æ‰‹åŠ¨è°ƒç”¨
      console.log('[SDK] Testing manual _notifyVisibilityChange call...');
      setTimeout(function() {
        console.log('[Test] Manually calling _notifyVisibilityChange(false)...');
        addLog('ğŸ§ª æµ‹è¯•ï¼šæ‰‹åŠ¨è°ƒç”¨ _notifyVisibilityChange(false)', 'event');
        window.AnyWP._notifyVisibilityChange(false);
        
        setTimeout(function() {
          console.log('[Test] Manually calling _notifyVisibilityChange(true)...');
          addLog('ğŸ§ª æµ‹è¯•ï¼šæ‰‹åŠ¨è°ƒç”¨ _notifyVisibilityChange(true)', 'event');
          window.AnyWP._notifyVisibilityChange(true);
        }, 2000);
      }, 1000);
      
      console.log('========== SDK INITIALIZATION COMPLETE ==========');
    }
    
    // ===========================================
    // å¯åŠ¨
    // ===========================================
    // å¯åŠ¨åŠ¨ç”»
    animateCircle();
    addLog('âœ… é¡µé¢åŠ è½½å®Œæˆ', 'event');
    addLog('ğŸ¬ åŠ¨ç”»å·²å¯åŠ¨', 'event');
    
    // åˆå§‹åŒ– SDK
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAnyWP);
    } else {
      initAnyWP();
    }
  </script>
</body>
</html>


