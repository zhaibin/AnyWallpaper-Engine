<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ç›´æ¥ WebMessage æµ‹è¯•</title>
  <style>
    body {
      margin: 20px;
      font-family: monospace;
      background: #0a0a0a;
      color: #00ff00;
    }
    
    #info {
      background: #1a1a1a;
      padding: 20px;
      border: 2px solid #ffeb3b;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    #mouseCoords {
      font-size: 24px;
      color: #ff5722;
      margin: 20px 0;
    }
    
    #log {
      background: #000;
      padding: 15px;
      border: 2px solid #4CAF50;
      border-radius: 8px;
      max-height: 400px;
      overflow-y: auto;
      font-size: 12px;
    }
    
    .log-entry {
      margin: 3px 0;
      padding: 3px 5px;
      border-left: 3px solid #4CAF50;
    }
    
    .log-error {
      border-left-color: #f44336;
      color: #f44336;
    }
  </style>
</head>
<body>
  <div id="info">
    <h1 style="color: #ffeb3b;">ğŸ” ç›´æ¥ WebMessage æµ‹è¯•</h1>
    <p>æœ¬é¡µé¢ç›´æ¥ç›‘å¬ WebView2 çš„ message äº‹ä»¶ï¼Œä¸ä¾èµ– AnyWP SDK</p>
    <div id="status">åˆå§‹åŒ–ä¸­...</div>
  </div>
  
  <div id="mouseCoords">é¼ æ ‡åæ ‡: ç­‰å¾…ä¸­...</div>
  
  <div id="log"></div>
  
  <script>
    // CRITICAL: First line to verify JavaScript executes
    console.log('[TEST] ========== JavaScript START ==========');
    console.log('[TEST] test_direct_webmessage.html loaded');
    
    let messageCount = 0;
    let mousemoveCount = 0;
    
    function addLog(message, isError) {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log-entry' + (isError ? ' log-error' : '');
      const time = new Date().toLocaleTimeString();
      entry.textContent = `[${time}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
      
      while (logDiv.children.length > 100) {
        logDiv.removeChild(logDiv.firstChild);
      }
      
      console.log(message);
    }
    
    // æ£€æŸ¥ WebView2 API
    if (window.chrome && window.chrome.webview) {
      document.getElementById('status').innerHTML = 
        '<span style="color: #4CAF50;">âœ… chrome.webview å¯ç”¨</span>';
      addLog('âœ… chrome.webview API å¯ç”¨');
      
      // ç›´æ¥æ³¨å†Œç›‘å¬å™¨
      window.chrome.webview.addEventListener('message', function(event) {
        messageCount++;
        const data = event.data;
        
        if (data && data.type === 'mouseEvent') {
          if (data.eventType === 'mousemove') {
            mousemoveCount++;
            
            // æ›´æ–°å®æ—¶åæ ‡
            document.getElementById('mouseCoords').textContent = 
              `é¼ æ ‡åæ ‡: (${data.x}, ${data.y}) - ç±»å‹: ${data.eventType} - è®¡æ•°: ${mousemoveCount}`;
            
            // æ¯ 50 ä¸ª mousemove æ‰“å°ä¸€æ¬¡æ—¥å¿—
            if (mousemoveCount % 50 === 0) {
              addLog(`æ”¶åˆ°ç¬¬ ${mousemoveCount} ä¸ª mousemove: (${data.x}, ${data.y})`);
            }
          } else {
            addLog(`æ”¶åˆ° ${data.eventType} äº‹ä»¶: (${data.x}, ${data.y})`);
            document.getElementById('mouseCoords').textContent = 
              `é¼ æ ‡åæ ‡: (${data.x}, ${data.y}) - ç±»å‹: ${data.eventType}`;
          }
        } else {
          addLog(`æ”¶åˆ°é mouseEvent æ¶ˆæ¯: ${JSON.stringify(data)}` );
        }
      });
      
      addLog('âœ… WebMessage ç›‘å¬å™¨å·²æ³¨å†Œ');
      addLog('ç°åœ¨ç§»åŠ¨é¼ æ ‡åˆ°é¡µé¢ä¸Š...');
    } else {
      document.getElementById('status').innerHTML = 
        '<span style="color: #f44336;">âŒ chrome.webview ä¸å¯ç”¨</span>';
      addLog('âŒ chrome.webview API ä¸å¯ç”¨ï¼è¿™ä¸æ˜¯ WebView2 ç¯å¢ƒ', true);
    }
  </script>
</body>
</html>

